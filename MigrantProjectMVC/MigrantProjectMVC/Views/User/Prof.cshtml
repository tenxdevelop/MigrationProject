@{
    ViewData["ShowHeader"] = true;
    ViewData["Title"] = "Профиль";
}

@model UserModel
<style>
    .form-control {
        border: none;
        border-radius: 0.25rem; 
        padding: 0.5rem; 
        transition: box-shadow 0.3s; 
    }
    .form-control:focus {
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25); 
    }
    .form-group {
        margin-bottom: 1.5rem; 
    }
    .input-group-text {
        background-color: #fff; 
        border: none; 
    }
</style>

<div class="container-fluid">
    <div class="row">

        <main class="col-md-9 ml-sm-auto col-lg-10 px-4">
            <h1 class="mt-4">Профиль пользователя</h1>
            <form id="profileForm" class="mt-4" method="post" action="saveUserData">
                <div class="form-group">
                    <label for="firstName">Имя</label>
                    <input type="text" class="form-control" id="firstName" name="firstName" value="@Model.Name" required>
                </div>
                <div class="form-group">
                    <label for="lastName">Фамилия</label>
                    <input type="text" class="form-control" id="lastName" name="lastName" value="@Model.Surname" required>
                </div>
                <div class="form-group">
                    <label for="patronymic">Отчество</label>
                    <input type="text" class="form-control" id="patronymic" name="patronymic" value="@Model.Patronymic" required>
                </div>
                <div class="form-group">
                    <label for="email">Электронная почта</label>
                    <input type="email" class="form-control" id="email" name="email" value="@Model.Email" required>
                </div>
                <div class="form-group">
                    <label for="phone">Телефон</label>
                    <input type="tel" class="form-control" id="phone" name="phone" value="@Model.Phone">
                </div>
                <div class="form-group d-flex flex-column">
                    <label>Выберите вашу страну гражданства</label>
                    <select name="country" class="form-select">
                        @foreach (var item in ViewBag.Countries)
                        {
                            <option>@item</option>
                        }
                    </select>   
                </div>
                <div>
                    <label>Выберите имеющиеся у вас документы</label>
                    <select onchange="addToForm()" id="documentSelect" class = "form-select" aria-label="Выберите документ">
                        <option selected id="selectLabel">Выберите из списка документы</option>
                        <option value="highlyQualified">Высоквалифированный специалист</option>
                        <option value="ressetlementProgrammMember">Член программы переселения</option>
                        <option value="consistsOfMigrationRegulation">Состоял на миграционном учёте раннее</option>
                    </select>
                    <div id="documentBox">
                        <p>Имеющиеся документы: </p>
                    </div>
                </div>
                <div id="documentBox">
                    <input type="hidden" id="documentNames" name="documentNames" value="">
                </div>
                <button type="submit" class="btn btn-primary">Сохранить изменения</button>
            </form>

            <div class="mt-5">
                <h2>Удалить аккаунт</h2>
                <p>Если вы хотите удалить свой аккаунт, пожалуйста, нажмите кнопку ниже.</p>
                <form action="DeleteSelf" method="post">
                    <button type="submit" class="btn btn-danger">Удалить аккаунт</button>
                </form>               
            </div>
        </main>
    </div>
</div>

<script>
    var documentBox = document.getElementById("documentBox")
    var selectedDocuments = []; // Массив для хранения выбранных документов

    function addToForm() {
        var documentSelect = document.getElementById("documentSelect");
        var selectedOption = documentSelect.options[documentSelect.selectedIndex];

        if(document.getElementById("selectLabel") != null) {
            document.getElementById("selectLabel").remove();
        }

        var documentValue = selectedOption.value;
        var documentText = selectedOption.text;

        if(selectedDocuments.includes(documentValue)) return;

        selectedDocuments.push(documentValue);

        // Обновляем скрытое поле (будет отправлено как строка с разделителем)
        document.getElementById("documentNames").value = selectedDocuments.join(',');

        // Визуальное отображение (без input, просто текст и кнопка удаления)
        var newDocumentLine = document.createElement('div');
        newDocumentLine.className = "d-flex flex-row";
        newDocumentLine.id = documentValue;
        newDocumentLine.innerHTML = `
            <span>${documentText}</span>
            <button class="btn btn-light" onclick="removeItemFromBox('${documentValue}')">X</button>
        `;
        documentBox.appendChild(newDocumentLine);
    }

    function removeItemFromBox(documentEnglishName){
        var element = document.getElementById(documentEnglishName)
        element.remove()
    }
</script>
